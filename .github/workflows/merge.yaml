---
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2024 The Linux Foundation

name: "🤖 DevOps Automation [Merged Pull Request]"

# yamllint disable-line rule:truthy
on:
  workflow_dispatch:
  push:
    branches:
      - main
      - master
    paths:
      - "**"
      #- "!.github/**"
      #- "!.*"
      #- "!pdm.lock"
      #- "!tox.ini"

permissions: {}

jobs:
  pull-request-merged:
    name: "Pull Request Merged"
    runs-on: "ubuntu-24.04"
    permissions:
      contents: read
    steps:
      # yamllint disable-line rule:line-length
      - uses: os-climate/osc-github-devops/.github/actions/git-last-commit-action@main

      - name: Summary Output
        shell: bash
        run: |
          # Report: Last Merged Pull Request

          # shellcheck disable=SC2129

          echo "# 🗞️ Report: Last Merged Pull Request" >> "$GITHUB_STEP_SUMMARY"
          echo "⏱️ Latest commit: ${{ env.latest_commit_sha }}" >> "$GITHUB_STEP_SUMMARY"
          echo "⏪ Previous commit: ${{ env.previous_commit_sha }}" >> "$GITHUB_STEP_SUMMARY"

          FILES_CHANGED="${{ env.files_changed }}"
          if [ -n "$FILES_CHANGED" ]; then
            echo "## 📁 Files Changed" >> "$GITHUB_STEP_SUMMARY"
            echo "$FILES_CHANGED" >> "$GITHUB_STEP_SUMMARY"
          fi

      - name: "Check: .github/workflows/merge.yaml"
        id: trap-version-bump
        uses: os-climate/osc-github-devops/.github/actions/string-in-multiline-text@main
        with:
          string: ".github/workflows/merge.yaml"
          multiline-text: "${{ env.files_changed }}"

      - name: "Report Match"
        shell: bash
        run: |
          # Report: Match
          echo "${{ steps.trap-version-bump.outputs.match }}"
