---
# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: 2024 The Linux Foundation <https://linuxfoundation.org>

name: "üîç [R] Repository Inspection"

# yamllint disable-line rule:truthy
on:
  workflow_call:
  push:
    paths:
      - "**"
      - "!.github/**"

jobs:
  repository:
    name: "Repository Checks"
    runs-on: ubuntu-latest
    outputs:
      # Classify repository content
      repo_python_project: ${{ steps.classify.outputs.repo_python_project }}
      repo_node_js_project: ${{ steps.classify.outputs.repo_node_js_project }}
      repo_maven_config: ${{ steps.classify.outputs.repo_maven_config }}
      repo_gradle_config: ${{ steps.classify.outputs.repo_gradle_config }}
      repo_jupyter_notebooks: ${{ steps.classify.outputs.repo_jupyter_notebooks }}
      repo_tox_config: ${{ steps.classify.outputs.repo_tox_config }}

      # Capture workflow metadata
      owner: ${{ steps.repository.outputs.owner }}
      repository: ${{ steps.repository.outputs.repository }}
      tagged: ${{ steps.repository.outputs.tagged }}

      #¬†Label verification
      present: ${{ steps.labelling.outputs.present }}
      created: ${{ steps.labelling.outputs.created }}

      # Tag metadata - to be removed/replaced
      current_tag: "v0.1.0" # Placeholder value
      tag_validity: "v0.1.0" # Placeholder value
      development_tag: "v0.1.0" # Placeholder value
      production_tag: "v0.1.0" # Placeholder value
      prerelease: "v0.1.0" # Placeholder value

    permissions:
      # Required for action to create labels: github-mandatory-labels
      contents: write
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - uses: actions/checkout@v4

      - name: "Classify repository content"
        id: classify
        # yamllint disable-line rule:line-length
        uses: os-climate/osc-github-devops/.github/actions/repository-content-classify@main

      - name: "Capture workflow metadata"
        id: repository
        # yamllint disable-line rule:line-length
        uses: os-climate/osc-github-devops/.github/actions/github-workflow-metadata@main

      - name: "Verify/create release labels"
        id: labelling
        # yamllint disable-line rule:line-length
        uses: os-climate/osc-github-devops/.github/actions/github-mandatory-labels@main
